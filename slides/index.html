<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=1024, user-scalable=no">

  <title>PyPy.js: What? How? Why?</title>

  <link rel="stylesheet" media="screen" href="deck.js/core/deck.core.css">
  <link rel="stylesheet" media="screen" href="deck.js/themes/mozilla/sandstone.default.css">

  <script src="deck.js/modernizr.custom.js"></script>
  <script src="deck.js/jquery.min.js"></script>
  <script src="deck.js/core/deck.core.js"></script>

  <script src="pypyjs/lib/Promise.min.js"></script>
  <script src="pypyjs/lib/pypy.js"></script>
  <script src="pypyjs/jquery-migrate-1.2.1.min.js"></script>
  <script src="pypyjs/jqconsole.min.js"></script>

  <style>
  body {
    overflow: hidden;
  }
  .deck-container .slide {
    font-size: 1.5em;
    padding: 1em;
    padding-top: 0.6em;
    border: none;
  }
  .deck-container .slide h1 {
    font-size: 2.5em;
    text-align: center;
  }
  .deck-container .slide h1 .h1sub {
    font-size: 0.5em;
  }
  .deck-container .slide h2 {
    padding-left: 1.3em;
  }
  .deck-container .slide blockquote {
    font-size: 1em;
  }
  .deck-container .slide table {
    font-size: 1em;
  }
  .deck-container .slide td {
    padding: 1em;
    padding-top: 0.4em;
    padding-bottom: 0.4em;
  }
  .deck-container .slide td + td {
    text-align: right;
  }
  .deck-container .slide .pypy-flow {
    text-align: center;
    width: 60%;
  }
  .deck-container .slide .emscripten-flow {
    text-align: center;
    width: 70%;
  }
  .deck-container .slide .pypyjs-flow {
    text-align: center;
    width: 90%;
  }
  .run-timer {
    position: absolute;
    top: 0px;
    right: 0px;
    background: black;
    height: 5px;
    width: 10px;
    opacity: 0.5;
  }
  .run-timer-slow-down {
    background: blue;
  }
  .run-timer-on-track {
    background: green;
  }
  .run-timer-move-on {
    background: orange;
  }
  .run-timer-hurry-up {
    background: red;
  }
  .deck-container .console {
    padding: 0.1em;
    width: 100%;
    text-align: center;
  }
  #console {
    position: relative;
    margin: 1em;
    width: 90%;
    height: 380px;
    text-align: left;
    background-color: white;
    border: 1px solid #333;
    font-size: 1em;
  }
  .jqconsole {
      padding: 10px;
  }
  .jqconsole-cursor {
      background-color: gray;
  }
  .jqconsole-blurred .jqconsole-cursor {
      background-color: #333;
  }
  .jqconsole-prompt {
      color: black;
  }
  .jqconsole-old-prompt {
      color: black;
      font-weight: normal;
  }
  .jqconsole-input {
      color: black;
  }
  .jqconsole-old-input {
      color: #bb0;
      font-weight: normal;
  }
  .jqconsole-output {
      color: #666;
  }
  </style>

</head>
<body>
<div class="deck-container">

  <div class="run-timer"></div>

  <section class="slide" style="text-align: center" run-time-min="0" run-time-max="240">
  <h1>PyPy.js<p class='h1sub'>What? How? Why?</p></h1>
  <p>Ryan Kelly<br />ryan@rfk.id.au</br>@rfkelly</p>
  </section>

  <section class="slide">
  <h1>Mozilla</h1>
  </section>

  <section class="slide">
  <h1>Mozilla</h1>
  <div style="text-align: center">
  <img src="./img/firefox_logo-only_RGB.png" style="height: 300px; width:319" />
  </div>
  </section>

  <section class="slide">
  <h1>Mozilla<br/>&#x2764<br/>The Web</h1>
  </section>

  <section class="slide">
  <h2>The Web</h2>
  <!-- uh-huh, table-based layout, like a boss... -->
  <table style="border: none; width: 100%">
  <tr><td style="width: 30%">
  </td><td style="text-align: left;">
    <p><b>Technology:</b></p>
    <ul>
      <li>HTTP</li>
      <li>HTML</li>
      <li>CSS</li>
      <li>JavaScript</li>
    </ul>
  </td><td style="width: 30%">
  </td><td style="text-align: left;">
    <p><b>Culture:</b></p>
    <ul>
      <li>Open</li>
      <li>Ubiquitous</li>
      <li>Secure</li>
      <li>Trustworthy</li>
    </ul>
  </td><td style="width: 30%"> </td></tr>
  </table>
  </section>

  <section class="slide">
  <h1>The Web is worth<br/>Keeping</h1>
  </section>

  <section class="slide">
  <h1>The Web is worth<br/>Improving</h1>
  </section>

  <section class="slide">
  <h1>The Web is worth<br/>Saving</h1>
  </section>

  <section class="slide">
  <h2>Andreas Gal, Mozilla CTO:</h2>
  <blockquote>"For Mozilla, anything that the Web canâ€™t do, or anything that the Web is not faster and better at than native technologies, is a bug."</blockquote>
  <p style="text-align: center;" class="slide"><a href="https://bugzilla.mozilla.org/">https://bugzilla.mozilla.org/</a></p>
  </section>

  <section class="slide">
  <h2>A Bug in the Web</h2>
  <blockquote>"Computing is going Mobile, and the Web is terrible on Mobile."</blockquote>
  </section>

  <section class="slide">
  <br/>
  <div style="text-align: center; width: 100%">
  <img src="./img/firefox-os_logo-wordmark_RGB.png" />
  </div>
  </section>

  <section class="slide">
  <h2>A Bug in the Web</h2>
  <blockquote>"The Web can't keep up with the performance demands of modern gaming."</blockquote>
  </section>

  <section class="slide">
  <br/>
  <table style="width: 100%"><tr><td style="text-align: center; width: 50%">
  <img src="./img/Unity_3D_logo.png" style="width: 70%" />
  </td><td style="text-align: center; width: 50%">
  <img src="./img/Unreal_Engine_3_logo_and_wordmark.png" style="width: 70%" />
  </td></tr></table>
  </section>

  <section class="slide">
  <h2>A Bug in the Web</h2>
  <blockquote>"I want to code in Python dammit"</blockquote>
  </section>

  <section class="slide">
  <br />
  <h1>???</h1>
  </section>

  <section class="slide" style="text-align: center">
  <h1>PyPy.js<p class='h1sub'>What? How? Why?</p></h1>
  </section>

  <section class="slide" run-time-min="240" run-time-max="600">
  <h1>What?</h1>
  </section>

  <section class="slide">
  <h2>PyPy.js: What?</h2>
  <div class="pyconsole"></div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Not the First</h2>
  <div style="text-align: center">
  <table style="width: 90%; display: inline"><tr><td>
    <ul>
    <li><span style="text-decoration: line-through">Pyjamas</span> PyJS</li>
    <li>Skulpt</li>
    <li>Brython</li>
    <li>PythonJS</li>
    </ul>
  </td><td style="width: 10%"></td><td style="text-align: left">
    <ul>
    <li>RapydScript</li>
    <li>Pystachio</li>
    <li>Pyjaco</li>
    <li>...?</li>
    </ul>
  </td></tr></table>
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... An Experiment</h2>
  <div style="text-align: center">
  <img src="./img/no-idea-what-im-doing.jpg" style="width: 60%" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Compliant</h2>
  <div class="pyconsole"></div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Fast</h2>
  <div class="pyconsole"></div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Fast (Enough)</h2>
  <div style="text-align: center">
  <table style="display: inline">
  <tr><th></th><th>Cold</th><th>Warm</th></tr>
  <tr><td>cpython</td><td>80 kpy/s</td><td>80 kpy/s</td></tr>
  <tr><td>pypy.js, firefox</td><td>40 kpy/s</td><td>150 kpy/s</td></tr>
  <tr style="opacity:0"><td>pypy.js, chrome</td><td>10 kpy/s</td><td>220 kpy/s</td></tr>
  <tr style="opacity:0"><td>pypy</td><td>700 kpy/s</td><td>2500 kpy/s</td></tr>
  </table>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Fast (Enough)</h2>
  <div style="text-align: center">
  <table style="display: inline">
  <tr><th></th><th>Cold</th><th>Warm</th></tr>
  <tr><td>cpython</td><td>80 kpy/s</td><td>80 kpy/s</td></tr>
  <tr><td>pypy.js, firefox</td><td>40 kpy/s</td><td>150 kpy/s</td></tr>
  <tr><td>pypy.js, chrome</td><td>10 kpy/s</td><td>220 kpy/s</td></tr>
  <tr style="opacity:0"><td>pypy</td><td>700 kpy/s</td><td>2500 kpy/s</td></tr>
  </table>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Fast (Enough)</h2>
  <div style="text-align: center">
  <table style="display: inline">
  <tr><th></th><th>Cold</th><th>Warm</th></tr>
  <tr><td>cpython</td><td>80 kpy/s</td><td>80 kpy/s</td></tr>
  <tr><td>pypy.js, firefox</td><td>40 kpy/s</td><td>150 kpy/s</td></tr>
  <tr><td>pypy.js, chrome</td><td>10 kpy/s</td><td>220 kpy/s</td></tr>
  <tr><td>pypy</td><td>700 kpy/s</td><td>2500 kpy/s</td></tr>
  </table>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... In-Browser</h2>
  <pre>
    var vm = new PyPyJS();

    vm.ready.then(function(){ ... })
  </pre>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... In-Browser</h2>
  <pre>
    var vm = new PyPyJS();

    vm.ready.then(function(){ ... })

    vm.set("x", 12).then(...)
  </pre>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... In-Browser</h2>
  <pre>
    var vm = new PyPyJS();

    vm.ready.then(function(){ ... })

    vm.set("x", 12).then(...)

    vm.eval("x = x + 1").then(...)
  </pre>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... In-Browser</h2>
  <pre>
    var vm = new PyPyJS();

    vm.ready.then(function(){ ... })

    vm.set("x", 12).then(...)

    vm.eval("x = x + 1").then(...)

    vm.get("x").then(...)
  </pre>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... In-Browser</h2>
  <div class="pyconsole"></div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ...</h2>
  <div style="text-align: center">
  <blockquote>"An experiment in building a fast, compliant, in-browser python environment"</blockquote>
  <p class="slide">But...<p>
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Not always Fast</h2>
  <div class="pyconsole"></div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Humongous</h2>
  <div style="text-align: center">
  <table style="display: inline">
  <tr><th></th><th>Raw</th><th>GZip</th></tr>
  <tr><td>pypy.vm.js</td><td>15M</td><td>2M</td></tr>
  <tr><td>pypy.vm.js.mem</td><td>5.5M</td><td>1.4M</td></tr>
  </table>
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js is ... Humongous</h2>
  <div style="text-align: center">
  <br/><br/>
  <a href="./pypyjs/index.html" target="_new">(Open Demo in New Tab)</a>
  </div>
  </section>

  <section class="slide" run-time-min="600" run-time-max="960">
  <h1>How?</h1>
  </section>

  <section class="slide">
  <h1>PyPy</h1>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <ul>
  <li>A Python interpreter, written in "RPython"</li>
  <li>A toolchain for translating RPython to C</li>
  <li>A JIT-Compiler-Generator</li>
  </ul>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <div style="text-align: center">
  <img class="pypy-flow" src="./img/pypy_flow/flow_diagram_0.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <div style="text-align: center">
  <img class="pypy-flow" src="./img/pypy_flow/flow_diagram_1.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <div style="text-align: center">
  <img class="pypy-flow" src="./img/pypy_flow/flow_diagram_2.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <div style="text-align: center">
  <img class="pypy-flow" src="./img/pypy_flow/flow_diagram_3.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <div style="text-align: center">
  <img class="pypy-flow" src="./img/pypy_flow/flow_diagram_4.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <div style="text-align: center">
  <img class="pypy-flow" src="./img/pypy_flow/flow_diagram_5.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy:</h2>
  <ul>
  <li>Excellent layering &amp; separation of concerns</li>
  <li>Flexible and Hackable</li>
  <li>A platform for <i>experimentation</i></li>
  </ul>
  </section>

  <section class="slide">
  <h1>Emscripten</h1>
  </section>

  <section class="slide">
  <h2>Emscripten:</h2>
  <ul>
  <li>An LLVM backend that generates JavaScript</li>
  <li>A simulated POSIX environment, in JavaScript</li>
  <li>Originally for porting games to the web</li>
  </ul>
  </section>

  <section class="slide">
  <h2>Emscripten:</h2>
  <div style="text-align: center">
  <img class="emscripten-flow" src="./img/emscripten_flow/flow_diagram_0.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>Emscripten:</h2>
  <div style="text-align: center">
  <img class="emscripten-flow" src="./img/emscripten_flow/flow_diagram_1.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>Emscripten:</h2>
  <div style="text-align: center">
  <img class="emscripten-flow" src="./img/emscripten_flow/flow_diagram_2.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>Emscripten:</h2>
  <div style="text-align: center">
  <img class="emscripten-flow" src="./img/emscripten_flow/flow_diagram_3.svg" />
  </div>
  </section>

  <section class="slide">
  <h1>asm.js</h1>
  </section>

  <section class="slide">
  <h2>asm.js</h2>
  <blockquote>"An extraordinarily optimizable, low-level subset of JavaScript"</blockquote>
  <p>&nbsp;</p>
  <div style="text-align: center; width:100%">There is ~90% of a "Virtual CPU" hidden inside JavaScript!</div>
  </section>

  <section class="slide">
  <br />
  <pre style="font-size: 0.8em;">
        function DiagModule(stdlib) {

            "use asm";

            var sqrt = stdlib.Math.sqrt;

            function square(x) {
                x = +x;
                return +(x*x);
            }

            function diag(x, y) {
                x = +x; y = +y;
                return +sqrt(+square(x) + +square(y));
            }

            return { diag: diag };
        }
  </pre>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_0.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_1.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_2.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_3.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_4.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_5.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_6.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_7.svg" />
  </div>
  </section>

  <section class="slide">
  <h1>Awful?</h1>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_7.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_8.svg" />
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: How?</h2>
  <div style="text-align: center">
  <img class="pypyjs-flow" src="./img/pypyjs_flow/flow_diagram_9.svg" />
  </div>
  </section>

  <section class="slide">
  <h1>It's awful<br/>all the way down</h1>
  </section>

  <section class="slide" run-time-min="960" run-time-max="1200">
  <h1>Why?</h1>
  </section>

  <section class="slide">
  <h2>PyPy.js: Why?</h2>
  <div style="text-align: center;">
  <img src="./img/smbcPT1.png" style="width: 45%"/>
  <p><a href="http://www.smbc-comics.com/index.php?id=2088">http://www.smbc-comics.com/index.php?id=2088</a></p>
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: Why?</h2>
  <div style="text-align: center;">
  <img src="./img/smbcPT2.png" style="width: 45%"/>
  <p><a href="http://www.smbc-comics.com/index.php?id=2088">http://www.smbc-comics.com/index.php?id=2088</a></p>
  </div>
  </section>

  <section class="slide">
  <h2>PyPy.js: Why?</h2>
  <span style="font-size:0.2em"><br/></span>
  <pre style="font-size: 1.5em">
    &lt;script type="text/python"&gt;

    print("buh-bye javascript!")

    &lt;/script&gt;
  </pre>
  </section>

  <section class="slide">
  <h1>You're gonna have<br/>a bad time</h1>
  </section>

  <section class="slide">
  <h2>Consider Alternatives</h2>
  <ul>
  <li>http://brython.info</li>
  <li>http://github.com/PythonJS</li>
  </ul>
  </section>

  <section class="slide">
  <h1>py2exe</h1>
  </section>

  <section class="slide">
  <h1>py2web</h1>
  </section>

  <section class="slide">
  <h1>py2web</h1>
  <h1>+ manifest.webapp</h1>
  </section>

  <section class="slide">
  <h1>py2web</h1>
  <h1>+ APK Factory</h1>
  </section>

  <section class="slide">
  <h1>IPython Notebook</h1>
  </section>

  <section class="slide">
  <h1>IPython Notebook</h1>
  <h1>+ NumPyPy</h1>
  </section>

  <section class="slide">
  <h2>PyPy.js: Why?</h2>
  <br/>
  <h1>Free Stuff!</h1>
  </section>

  <section class="slide">
  <h1>Please, file bugs<br/>against the Web</h1>
  </section>

  <section class="slide" run-time-min="1200" run-time-max="1400">
  <h1>Who?</h1>
  </section>

  <section class="slide">
  <h1>You!</h1>
  </section>

  <section class="slide">
  <h2>There's a lot of fun stuff here:</h2>
  <ul>
  <li>API design</li>
  <li>Optimizations</li>
  <li>Algorithms</li>
  <li>Tooling</li>
  <li>And much more!</li>
  </ul>
  </section>

  <section class="slide">
  <h1>You.<br/>Tomorrow.<br/>At the Sprints.</h1>
  </section>

  <section class="slide">
  <div style="text-align: center">
    <p>ryan@rfk.id.au</p>
    <p>@rfkelly</p>
    <br/>
    <p>http://pypyjs.org/</p>
    <p>http://github.com/rfk/talk-pypyjs-what-how-why</p>
  </div>
  </section>

<script>
  $(function() {
    $.deck('.slide');
  });
</script>

<script>
  $(function() {
    $.deck('.slide');
    var $allSlides = $(".slide");
    var $slide = null;
    var talkStartTime = null;
    $(document).bind("deck.change", function(event, from, to) {
      $slide = $.deck("getSlide", to);
      var $console = $slide.find(".pyconsole");
      if ($console.length) {
        $("#console").appendTo($console).show();
        window.jqconsole.Reset();
        window.jqconsole.BeginPromptLoop();
        window.jqconsole.Focus();
      } else {
        $("#console").hide();
      }
      updateRunTimer();
    });
    function updateRunTimer() {
      // Clear previous status, if any.
      var $runTimer = $(".run-timer");
      $runTimer.removeClass("run-timer-slow-down")
               .removeClass("run-timer-on-track")
               .removeClass("run-timer-move-on")
               .removeClass("run-timer-hurry-up")
      // Find the nearest slide with min/max runtime set.
      if (!$slide || !$slide.length) return;
      var curpos = 0;
      while (curpos < $allSlides.length) {
        if ($allSlides[curpos] == $slide[0]) {
          break;
        }
        curpos++;
      }
      var i = curpos - 1;
      var runTimeMin = $slide.attr("run-time-min");
      while (!runTimeMin && i >= 0) {
        runTimeMin = $allSlides.eq(i).attr("run-time-min");
        i--;
      }
      i = curpos - 1;
      var runTimeMax = $slide.attr("run-time-max");
      while (!runTimeMax && i >= 0) {
        runTimeMax = $allSlides.eq(i).attr("run-time-max");
        i--;
      }
      // Tweak status of runtime tracker accordingly.
      if($slide[0] != $allSlides[0]) {
        if(talkStartTime == null) {
          talkStartTime = Math.round((new Date()).getTime() / 1000);
        }
        var runTime = Math.round((new Date()).getTime() / 1000) - talkStartTime;
        console.log("runtime", runTime, runTimeMin, runTimeMax);
        if (runTimeMin && runTime < parseInt(runTimeMin, 10)|0) {
          $runTimer.addClass("run-timer-slow-down")
          console.log("slow down");
        } else if (runTimeMax && runTime >= parseInt(runTimeMax, 10)|0) {
          $runTimer.addClass("run-timer-hurry-up")
          console.log("hurry up");
        } else if (runTimeMax && runTime >= (parseInt(runTimeMax, 10)|0) - 30) {
          console.log("move on");
          $runTimer.addClass("run-timer-move-on")
        } else {
          console.log("on track");
          $runTimer.addClass("run-timer-on-track")
        }
      }
    }
    setInterval(updateRunTimer, 5*1000);
  });
</script>

<div id="console" style="display: hidden"></div>
<script>
  $(function () {
    window.jqconsole = $('#console').jqconsole('', '>>> ');
    window.vm = new PyPyJS();
    vm.stdout = vm.stderr = function(data) {
      jqconsole.Write(data, 'jqconsole-output');
    }
    vm.ready.then(function() {
      jqconsole.Reset();
      vm.stdout('Welcome to PyPy.js!\n')
      // Create an 'InteractiveConsole' to simulate the python shell.
      vm.eval('import code').then(function() {
        vm.eval('c = code.InteractiveConsole()').then(function() {
          // Prompt for input, send it to the console, rinse, repeat.
          jqconsole.BeginPromptLoop = function () {
            jqconsole.Prompt(true, function (input) {
              var code = input.replace(/\\/g, "\\\\").replace(/'/g, "\\'");
              code = 'r = c.push(\'' + code + '\')';
              vm.eval(code).then(function() {
                return vm.get('r').then(function(r) {
                  if (r) {
                    jqconsole.SetPromptLabel("... ");
                  } else {
                    jqconsole.SetPromptLabel(">>> ");
                  }
                  setTimeout(jqconsole.BeginPromptLoop, 0);
                });
              });
            });
          };
          jqconsole.BeginPromptLoop();
          // Start hidden.
          $("#console").hide();
        });
      });
    });
  });
</script>


</div>
</body>
